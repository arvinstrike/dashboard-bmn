<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Statistik Pengajuan BMN</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    {{-- Custom Alert System --}}
    @include('includes.custom-alert')

    <style>
        :root {
            --bs-primary-rgb: 79, 70, 229;
            /* Indigo */
            --bs-body-font-family: 'Inter', sans-serif;
        }

        body {
            background-color: #F7F9FC;
        }

        /* Minimalist Stat Card */
        .stat-card {
            border: 1px solid #E5E7EB;
            border-radius: 0.75rem;
            padding: 1.5rem;
            background-color: #fff;
            transition: all 0.2s ease-in-out;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        .stat-card .stat-title {
            font-weight: 500;
            color: #6B7280;
            /* Muted gray */
            font-size: 0.9rem;
            display: flex;
            align-items: center;
        }

        .stat-card .stat-title .bi {
            font-size: 1.1rem;
            margin-right: 0.5rem;
        }

        .stat-card .stat-value {
            font-size: 2rem;
            /* Consistent font size */
            font-weight: 600;
            color: #111827;
            margin-top: 0.25rem;
        }

        /* Highlight with Border */
        .stat-card-highlight-border {
            border-left: 5px solid rgb(var(--bs-primary-rgb));
        }

        .stat-card-highlight-border .stat-title .bi,
        .stat-card-highlight-border .stat-value {
            color: rgb(var(--bs-primary-rgb));
        }

        /* Icon Colors */
        .text-primary-dark {
            color: #2563eb !important;
        }

        .text-warning-dark {
            color: #ea580c !important;
        }

        .text-success-dark {
            color: #059669 !important;
        }

        .text-danger-dark {
            color: #dc3545 !important;
        }

        .text-gray-dark {
            color: #6B7280 !important;
        }


        /* Chart Container */
        .chart-container {
            position: relative;
            height: 400px;
            margin-bottom: 2rem;
        }

        /* Filter Section */
        .filter-header a {
            text-decoration: none;
            color: inherit;
        }

        .filter-header .chevron-icon {
            transition: transform 0.3s ease;
        }

        .filter-header a[aria-expanded="true"] .chevron-icon {
            transform: rotate(180deg);
        }

        /* Force the filter card to be on top and allow its children to overflow */
        .card.mb-4 {
            /* Targeting the filter card specifically */
            z-index: 20;
            /* A higher z-index to lift it above the next card */
            position: relative;
            /* z-index requires a position other than static */
        }

        #filterCollapse,
        #filterCollapse .card-body {
            overflow: visible !important;
            /* Force overflow visibility on the collapsible area and its body */
        }

        /* Fix for dropdowns being cut off - Robust solution */
        .card {
            overflow: visible;
        }

        .card-body {
            overflow: visible;
            position: relative;
        }

        /* Ensure select dropdowns show properly */
        .form-select {
            z-index: 1050 !important;
            /* Higher than Bootstrap's modal z-index */
            position: relative;
        }

        /* Additional fix for dropdown menu positioning */
        .dropdown-menu {
            z-index: 1060 !important;
            /* Higher than form-select to ensure visibility */
        }

        /* Specific fix for select dropdown that appears cut off */
        .select-wrapper {
            position: relative;
            z-index: 1040;
        }

        /* Badge Styles */
        .badge-status {
            font-size: .8rem;
            font-weight: 500;
            padding: .4em .8em;
            border-radius: 9999px;
        }

        .badge-green {
            background-color: #D1FAE5;
            color: #065F46;
        }

        .badge-red {
            background-color: #FEE2E2;
            color: #991B1B;
        }

        .badge-yellow {
            background-color: #FEF3C7;
            color: #92400E;
        }

        .badge-blue {
            background-color: #DBEAFE;
            color: #1E40AF;
        }

        .badge-gray {
            background-color: #F3F4F6;
            color: #374151;
        }
    </style>
</head>

<body>
    <div class="container-fluid p-4 p-lg-5">
        <h1 class="h2 fw-bold mb-4" style="color: rgb(var(--bs-primary-rgb));"> Dashboard Pengajuan RKBMN</h1>

        <!-- Stat Cards -->
        <div class="row row-cols-1 row-cols-md-2 row-cols-lg-5 g-4 mb-4">
            <div class="col">
                <div class="card stat-card h-100 d-flex flex-column">
                    <p class="stat-title mb-1">
                        <i class="bi bi-journal-text text-primary-dark"></i>
                        Total Pengajuan
                    </p>
                    <p class="stat-value mb-0 mt-auto">{{ $stats['total_pengajuan'] }}</p>
                </div>
            </div>
            <div class="col">
                <div class="card stat-card h-100 d-flex flex-column">
                    <p class="stat-title mb-1">
                        <i class="bi bi-clock-history text-warning-dark"></i>
                        Menunggu Persetujuan
                    </p>
                    <p class="stat-value mb-0 mt-auto">{{ $stats['menunggu_persetujuan'] }}</p>
                </div>
            </div>
            <div class="col">
                <div class="card stat-card h-100 d-flex flex-column">
                    <p class="stat-title mb-1">
                        <i class="bi bi-check2-circle text-success-dark"></i>
                        Disetujui
                    </p>
                    <p class="stat-value mb-0 mt-auto">{{ $stats['approved'] }}</p>
                </div>
            </div>
            <div class="col">
                <div class="card stat-card h-100 d-flex flex-column">
                    <p class="stat-title mb-1">
                        <i
                            class="bi bi-x-circle @if ($stats['rejected'] > 0) text-danger-dark @else text-gray-dark @endif"></i>
                        Ditolak
                    </p>
                    <p class="stat-value mb-0 mt-auto">{{ $stats['rejected'] }}</p>
                </div>
            </div>
            <div class="col">
                <div class="card stat-card stat-card-highlight-border h-100 d-flex flex-column">
                    <p class="stat-title mb-1">
                        <i class="bi bi-wallet2"></i>
                        Anggaran Disetujui
                    </p>
                    <p class="stat-value mb-0 mt-auto">
                        @php
                            $anggaran = $stats['anggaran_disetujui'];
                            if ($anggaran >= 1000000000000) {
                                echo 'Rp ' . number_format($anggaran / 1000000000000, 2, ',', '.') . 'T';
                            } elseif ($anggaran >= 1000000000) {
                                echo 'Rp ' . number_format($anggaran / 1000000000, 2, ',', '.') . 'M';
                            } else {
                                echo 'Rp ' . number_format($anggaran / 1000000, 2, ',', '.') . 'JT';
                            }
                        @endphp
                    </p>
                </div>
            </div>
        </div>



        <!-- Charts Section -->



                <div class="row g-4 mb-4">



        



                    <div class="col-md-6">



                        <div class="card h-100">



                            <div class="card-header d-flex justify-content-between align-items-center">



                                <div>



                                    <i class="bi bi-bar-chart me-2"></i>Distribusi Status Pengajuan



                                </div>



                                <div>



                                    {{-- Note: This requires the controller to pass a $stats['tahun_stats'] variable --}}



                                    <select id="statusYearFilter" class="form-select form-select-sm" style="width: auto;">



                                        <option value="all">Semua Tahun</option>



                                        @if (isset($stats['tahun_stats']))



                                            @foreach ($stats['tahun_stats'] as $tahun)



                                                <option value="{{ $tahun->tahun_anggaran }}">{{ $tahun->tahun_anggaran }}



                                                </option>



                                            @endforeach



                                        @endif



                                    </select>



                                </div>



                            </div>



                            <div class="card-body h-100">



                                <div class="chart-container">



                                    <canvas id="statusChart"></canvas>



                                </div>



                            </div>



                        </div>



                    </div>



        



                    <div class="col-md-6">



                        <div class="card h-100">



                            <div class="card-header">



                                <i class="bi bi-bar-chart me-2"></i>Pengajuan per Tahun Anggaran



                            </div>



                            <div class="card-body h-100">



                                <div class="chart-container">



                                    <canvas id="yearChart"></canvas>



                                </div>



                            </div>



                        </div>



                    </div>



                    



                </div>



                <div class="row g-4 mb-4">



        



                    <div class="col-md-6">



                        <div class="card h-100">



                            <div class="card-header d-flex justify-content-between align-items-center">



                                <div>



                                    <i class="bi bi-pie-chart me-2"></i>Pengajuan per Bagian Pengusul



                                </div>



                                <div>



                                    <select id="bagianYearFilter" class="form-select form-select-sm" style="width: auto;">



                                        <option value="all">Semua Tahun</option>



                                        @if (isset($stats['tahun_stats']))



                                            @foreach ($stats['tahun_stats'] as $tahun)



                                                <option value="{{ $tahun->tahun_anggaran }}">{{ $tahun->tahun_anggaran }}</option>



                                            @endforeach



                                        @endif



                                    </select>



                                </div>



                            </div>



                            <div class="card-body h-100">



                                <div class="chart-container">



                                    <canvas id="bagianChart"></canvas>



                                </div>



                            </div>



                        </div>



                    </div>



        



                    <div class="col-md-6">



                        <div class="card h-100">



                            <div class="card-header d-flex justify-content-between align-items-center">



                                <div>



                                    <i class="bi bi-bar-chart-line me-2"></i>Total Anggaran per Bagian



                                </div>



                                <div>



                                    <select id="anggaranBagianYearFilter" class="form-select form-select-sm"



                                        style="width: auto;">



                                        <option value="all">Semua Tahun</option>



                                        @if (isset($stats['tahun_stats']))



                                            @foreach ($stats['tahun_stats'] as $tahun)



                                                <option value="{{ $tahun->tahun_anggaran }}">{{ $tahun->tahun_anggaran }}</option>



                                            @endforeach



                                        @endif



                                    </select>



                                </div>



                            </div>



                            <div class="card-body h-100">



                                <div class="chart-container">



                                    <canvas id="anggaranBagianChart"></canvas>



                                </div>



                            </div>



                        </div>



                    </div>



        



                </div>







        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>



                <script>



                    // JavaScript to generate charts



        



        



        



                    document.addEventListener('DOMContentLoaded', function() {



        



        



        



                        // NOTE:



        



        



        



                        // The following change assumes the backend will provide a `$statusStatsByYear` variable.



        



        



        



                        // This variable should be a dictionary where keys are years and values are status statistics for that year.



        



        



        



                        // Example:



        



        



        



                        // $statusStatsByYear = [



        



        



        



                        //     '2023' => ['approved' => 10, 'rejected' => 2, 'pending' => 5],



        



        



        



                        //     '2024' => ['approved' => 15, 'rejected' => 3, 'pending' => 8],



        



        



        



                        // ];



        



        



        



                        const statusStatsByYear = @json($statusStatsByYear ?? []);



        



        



        



                        const allYearStatusStats = @json($stats['status_stats'] ?? []);



        



        



        



        



        



        



        



                        // Status Chart - Pie Chart



        



        



        



                        const statusCtx = document.getElementById('statusChart').getContext('2d');



        



        



        



        



        



        



        



                        const statusColorMap = {



        



        



        



                            'Approved': 'rgba(16, 185, 129, 0.8)', // Emerald



        



        



        



                            'Completed': 'rgba(79, 70, 229, 0.8)', // Indigo



        



        



        



                            'Rejected': 'rgba(239, 68, 68, 0.8)', // Red



        



        



        



                            'Pending': 'rgba(245, 158, 11, 0.8)', // Amber



        



        



        



                            'In progress': 'rgba(59, 130, 246, 0.8)', // Blue



        



        



        



                            'Draft': 'rgba(107, 114, 128, 0.8)', // Gray



        



        



        



                            'Diajukan Ke Unit Pelaksana': 'rgba(255, 165, 0, 0.8)', // Orange



        



        



        



                        };



        



        



        



        



        



        



        



                        const statusBorderColorMap = {



        



        



        



                            'Approved': 'rgba(16, 185, 129, 1)',



        



        



        



                            'Completed': 'rgba(79, 70, 229, 1)',



        



        



        



                            'Rejected': 'rgba(239, 68, 68, 1)',



        



        



        



                            'Pending': 'rgba(245, 158, 11, 1)',



        



        



        



                            'In progress': 'rgba(59, 130, 246, 1)',



        



        



        



                            'Draft': 'rgba(107, 114, 128, 1)',



        



        



        



                            'Diajukan Ke Unit Pelaksana': 'rgba(255, 165, 0, 1)', // Orange



        



        



        



                        };



        



        



        



        



        



        



        



                        let statusChart;



        



        



        



        



        



        



        



                        function updateStatusChart(chart, data) {



        



        



        



                            const labels = Object.keys(data).map(status => status.split('_').map(word => word.charAt(0)



                                .toUpperCase() + word.slice(1)).join(' '));



        



        



        



                            const counts = Object.values(data);



        



        



        



        



        



        



        



                            chart.data.labels = labels;



        



        



        



                            chart.data.datasets[0].data = counts;



        



        



        



                            chart.data.datasets[0].backgroundColor = labels.map(label => statusColorMap[label] ||



                                'rgba(156, 163, 175, 0.8)');



        



        



        



                            chart.data.datasets[0].borderColor = labels.map(label => statusBorderColorMap[label] ||



                                'rgba(156, 163, 175, 1)');



        



        



        



                            chart.update();



        



        



        



                        }



        



        



        



        



        



        



        



                        function createStatusChart(initialData) {



        



        



        



                            const labels = Object.keys(initialData).map(status => status.split('_').map(word => word.charAt(0)



                                .toUpperCase() + word.slice(1)).join(' '));



        



        



        



                            const counts = Object.values(initialData);



        



        



        



        



        



        



        



                            return new Chart(statusCtx, {



        



        



        



                                type: 'pie',



        



        



        



                                data: {



        



        



        



                                    labels: labels,



        



        



        



                                    datasets: [{



        



        



        



                                        label: 'Jumlah Pengajuan',



        



        



        



                                        data: counts,



        



        



        



                                        backgroundColor: labels.map(label => statusColorMap[label] ||



                                            'rgba(156, 163, 175, 0.8)'),



        



        



        



                                        borderColor: labels.map(label => statusBorderColorMap[label] ||



                                            'rgba(156, 163, 175, 1)'),



        



        



        



                                        borderWidth: 1



        



        



        



                                    }]



        



        



        



                                },



        



        



        



                                options: {



        



        



        



                                    responsive: true,



        



        



        



                                    maintainAspectRatio: false,



        



        



        



                                    plugins: {



        



        



        



                                        legend: {



        



        



        



                                            position: 'bottom',



        



        



        



                                        },



        



        



        



                                        title: {



        



        



        



                                            display: true,



        



        



        



                                            text: 'Distribusi Status Pengajuan'



        



        



        



                                        }



        



        



        



                                    }



        



        



        



                                }



        



        



        



                            });



        



        



        



                        }



        



        



        



        



        



        



        



                        if (Object.keys(allYearStatusStats).length > 0) {



        



        



        



                            statusChart = createStatusChart(allYearStatusStats);



        



        



        



                        }



        



        



        



        



        



        



        



                        document.getElementById('statusYearFilter').addEventListener('change', function() {



        



        



        



                            const selectedYear = this.value;



        



        



        



                            if (selectedYear === 'all') {



        



        



        



                                updateStatusChart(statusChart, allYearStatusStats);



        



        



        



                            } else if (statusStatsByYear[selectedYear]) {



        



        



        



                                updateStatusChart(statusChart, statusStatsByYear[selectedYear]);



        



        



        



                            } else {



        



        



        



                                // If no data for the year, clear the chart



        



        



        



                                updateStatusChart(statusChart, {});



        



        



        



                            }



        



        



        



                        });



        



        



        



        



        



        



        



                        // Year Chart - Line Chart



        



        



        



        



        



        



        



                        const yearCtx = document.getElementById('yearChart').getContext('2d');



        



        



        



        



        



        



        



                        const yearChart = new Chart(yearCtx, {



        



        



        



        



        



        



        



                            type: 'line',



        



        



        



        



        



        



        



                            data: {



        



        



        



        



        



        



        



                                labels: [



        



        



        



        



        



        



        



                                    @foreach ($stats['tahun_stats'] as $tahun)



        



        



        



        



        



        



        



                                        '{{ $tahun->tahun_anggaran }}',



                                    @endforeach



        



        



        



        



        



        



        



                                ],



        



        



        



        



        



        



        



                                datasets: [{



        



        



        



        



        



        



        



                                    label: 'Jumlah Pengajuan',



        



        



        



        



        



        



        



                                    data: [



        



        



        



        



        



        



        



                                        @foreach ($stats['tahun_stats'] as $tahun)



        



        



        



        



        



        



        



                                            {{ $tahun->count }},



                                        @endforeach



        



        



        



        



        



        



        



                                    ],



        



        



        



        



        



        



        



                                    backgroundColor: 'rgba(79, 70, 229, 0.6)',



        



        



        



        



        



        



        



                                    borderColor: 'rgba(79, 70, 229, 1)',



        



        



        



        



        



        



        



                                    borderWidth: 2,



        



        



        



        



        



        



        



                                    fill: false, // Don't fill the area under the line



        



        



        



        



        



        



        



                                    tension: 0.4 // Smooth the line



        



        



        



        



        



        



        



                                }]



        



        



        



        



        



        



        



                            },



        



        



        



        



        



        



        



                            options: {



        



        



        



        



        



        



        



                                responsive: true,



        



        



        



        



        



        



        



                                maintainAspectRatio: false,



        



        



        



        



        



        



        



                                plugins: {



        



        



        



        



        



        



        



                                    legend: {



        



        



        



        



        



        



        



                                        display: true // Display legend for line chart



        



        



        



        



        



        



        



                                    },



        



        



        



        



        



        



        



                                    title: {



        



        



        



        



        



        



        



                                        display: true,



        



        



        



        



        



        



        



                                        text: 'Jumlah Pengajuan per Tahun Anggaran'



        



        



        



        



        



        



        



                                    }



        



        



        



        



        



        



        



                                },



        



        



        



        



        



        



        



                                scales: {



        



        



        



        



        



        



        



                                    y: {



        



        



        



        



        



        



        



                                        beginAtZero: true,



        



        



        



        



        



        



        



                                        display: true // Show y-axis labels



        



        



        



        



        



        



        



                                    },



        



        



        



        



        



        



        



                                    x: {



        



        



        



        



        



        



        



                                        display: true // Show x-axis labels



        



        



        



        



        



        



        



                                    }



        



        



        



        



        



        



        



                                },



        



        



        



        



        



        



        



                                interaction: {



        



        



        



        



        



        



        



                                    intersect: false,



        



        



        



        



        



        



        



                                    mode: 'index'



        



        



        



        



        



        



        



                                }



        



        



        



        



        



        



        



                            }



        



        



        



        



        



        



        



                        });



        



        



        



        



        



        



        



                        // Bagian Chart - Pie Chart



        



        



        



        



        



        



        



                        const bagianCtx = document.getElementById('bagianChart').getContext('2d');



        



        



        



        



        



        



        



                        const bagianStatsByYear = @json($bagianStatsByYear ?? []);



        



        



        



        



        



        



        



                        const allYearBagianStats = {



        



        



        



        



        



        



        



                            @foreach ($stats['bagian_stats'] as $bagian)



        



        



        



        



        



        



        



                                '{{ $bagian->nama_bagian }}': {{ $bagian->count }},



                            @endforeach



        



        



        



        



        



        



        



                        };



        



        



        



        



        



        



        



        



        



        



        



        



        



        



        



                        let bagianChart;



        



        



        



        



        



        



        



        



        



        



        



        



        



        



        



                        function updateBagianChart(chart, data) {



        



        



        



        



        



        



        



                            const labels = Object.keys(data);



        



        



        



        



        



        



        



                            const counts = Object.values(data);



        



        



        



        



        



        



        



        



        



        



        



        



        



        



        



                            chart.data.labels = labels;



        



        



        



        



        



        



        



                            chart.data.datasets[0].data = counts;



        



        



        



        



        



        



        



                            chart.update();



        



        



        



        



        



        



        



                        }



        



        



        



        



        



        



        



        



        



        



        



        



        



        



        



                        function createBagianChart(initialData) {



        



        



        



        



        



        



        



                            const labels = Object.keys(initialData);



        



        



        



        



        



        



        



                            const counts = Object.values(initialData);



        



        



        



        



        



        



        



        



        



        



        



        



        



        



        



                            return new Chart(bagianCtx, {



        



        



        



        



        



        



        



                                type: 'pie',



        



        



        



        



        



        



        



                                data: {



        



        



        



        



        



        



        



                                    labels: labels,



        



        



        



        



        



        



        



                                    datasets: [{



        



        



        



        



        



        



        



                                        label: 'Jumlah Pengajuan',



        



        



        



        



        



        



        



                                        data: counts,



        



        



        



        



        



        



        



                                        backgroundColor: [



        



        



        



        



        



        



        



                                            'rgba(79, 70, 229, 0.8)',



        



        



        



        



        



        



        



                                            'rgba(239, 68, 68, 0.8)',



        



        



        



        



        



        



        



                                            'rgba(245, 158, 11, 0.8)',



        



        



        



        



        



        



        



                                            'rgba(16, 185, 129, 0.8)',



        



        



        



        



        



        



        



                                            'rgba(139, 92, 246, 0.8)',



        



        



        



        



        



        



        



                                            'rgba(16, 158, 149, 0.8)',



        



        



        



        



        



        



        



                                            'rgba(241, 112, 110, 0.8)',



        



        



        



        



        



        



        



                                            'rgba(99, 102, 241, 0.8)'



        



        



        



        



        



        



        



                                        ],



        



        



        



        



        



        



        



                                        borderColor: '#fff',



        



        



        



        



        



        



        



                                        borderWidth: 1



        



        



        



        



        



        



        



                                    }]



        



        



        



        



        



        



        



                                },



        



        



        



        



        



        



        



                                options: {



        



        



        



        



        



        



        



                                    responsive: true,



        



        



        



        



        



        



        



                                    maintainAspectRatio: false,



        



        



        



        



        



        



        



                                    plugins: {



        



        



        



        



        



        



        



                                        legend: {



        



        



        



        



        



        



        



                                            position: 'bottom',



        



        



        



                                        },



        



        



        



        



        



        



        



                                        title: {



        



        



        



        



        



        



        



                                            display: true,



        



        



        



        



        



        



        



                                            text: 'Pengajuan per Bagian Pengusul'



        



        



        



        



        



        



        



                                        }



        



        



        



        



        



        



        



                                    }



        



        



        



        



        



        



        



                                }



        



        



        



        



        



        



        



                            });



        



        



        



        



        



        



        



                        }



        



        



        



        



        



        



        



        



        



        



        



        



        



        



        



                        if (Object.keys(allYearBagianStats).length > 0) {



        



        



        



        



        



        



        



                            bagianChart = createBagianChart(allYearBagianStats);



        



        



        



        



        



        



        



                        }



        



        



        



        



        



        



        



        



        



        



        



        



        



        



        



                        document.getElementById('bagianYearFilter').addEventListener('change', function() {



        



        



        



        



        



        



        



                            const selectedYear = this.value;



        



        



        



        



        



        



        



                            if (selectedYear === 'all') {



        



        



        



        



        



        



        



                                updateBagianChart(bagianChart, allYearBagianStats);



        



        



        



        



        



        



        



                            } else if (bagianStatsByYear[selectedYear]) {



        



        



        



        



        



        



        



                                updateBagianChart(bagianChart, bagianStatsByYear[selectedYear]);



        



        



        



        



        



        



        



                            } else {



        



        



        



        



        



        



        



                                updateBagianChart(bagianChart, {});



        



        



        



        



        



        



        



                            }



        



        



        



        



        



        



        



                        });



        



        



        



        



        



        



        



        



        



        



        



        



        



        



        



                        // Anggaran per Bagian Chart



        



        



        



        



        



        



        



                        const anggaranBagianCtx = document.getElementById('anggaranBagianChart').getContext('2d');



        



        



        



        



        



        



        



                        const anggaranBagianByYear = @json($anggaranBagianByYear ?? []);



        



        



        



        



        



        



        



                        const allYearAnggaranBagian = {



        



        



        



        



        



        



        



                            @foreach ($stats['bagian_stats'] as $bagian)



        



        



        



        



        



        



        



                                '{{ $bagian->nama_bagian }}': {{ $bagian->total_anggaran }},



                            @endforeach



        



        



        



        



        



        



        



                        };



        



        



        



        



        



        



        



        



        



        



        



        



        



        



        



                        let anggaranBagianChart;



        



        



        



        



        



        



        



        



        



        



        



        



        



        



        



                        function getAcronym(name) {



        



        



        



        



        



        



        



                            return name.split(' ').map(word => word[0]).join('');



        



        



        



        



        



        



        



                        }



        



        



        



        



        



        



        



        



        



        



        



        



        



        



        



                        function updateAnggaranBagianChart(chart, data) {



        



        



        



        



        



        



        



                            // Sort data from highest to lowest



        



        



        



        



        



        



        



                            const sortedData = Object.entries(data).sort(([, a], [, b]) => b - a);



        



        



        



        



        



        



        



        



        



        



        



        



        



        



        



                            const labels = sortedData.map(([key]) => getAcronym(key));



        



        



        



        



        



        



        



                            const fullLabels = sortedData.map(([key]) => key);



        



        



        



        



        



        



        



                            const counts = sortedData.map(([, value]) => value);



        



        



        



        



        



        



        



        



        



        



        



        



        



        



        



                            chart.data.labels = labels;



        



        



        



        



        



        



        



                            chart.data.datasets[0].data = counts;



        



        



        



        



        



        



        



                            chart.options.plugins.tooltip.callbacks.title = function(tooltipItems) {



        



        



        



        



        



        



        



                                return fullLabels[tooltipItems[0].dataIndex];



        



        



        



        



        



        



        



                            };



        



        



        



        



        



        



        



                            chart.update();



        



        



        



        



        



        



        



                        }



        



        



        



        



        



        



        



        



        



        



        



        



        



        



        



                        function createAnggaranBagianChart(initialData) {



        



        



        



        



        



        



        



                            const sortedData = Object.entries(initialData).sort(([, a], [, b]) => b - a);



        



        



        



        



        



        



        



        



        



        



        



        



        



        



        



                            const labels = sortedData.map(([key]) => getAcronym(key));



        



        



        



        



        



        



        



                            const fullLabels = sortedData.map(([key]) => key);



        



        



        



        



        



        



        



                            const counts = sortedData.map(([, value]) => value);



        



        



        



        



        



        



        



        



        



        



        



        



        



        



        



                            return new Chart(anggaranBagianCtx, {



        



        



        



        



        



        



        



                                type: 'bar',



        



        



        



        



        



        



        



                                data: {



        



        



        



        



        



        



        



                                    labels: labels,



        



        



        



        



        



        



        



                                    datasets: [{



        



        



        



        



        



        



        



                                        label: 'Total Anggaran',



        



        



        



        



        



        



        



                                        data: counts,



        



        



        



        



        



        



        



                                        backgroundColor: 'rgba(239, 68, 68, 0.6)', // Red



        



        



        



        



        



        



        



                                        borderColor: 'rgba(239, 68, 68, 1)',



        



        



        



        



        



        



        



                                        borderWidth: 1



        



        



        



        



        



        



        



                                    }]



        



        



        



        



        



        



        



                                },



        



        



        



        



        



        



        



                                options: {



        



        



        



        



        



        



        



                                    indexAxis: 'y',



        



        



        



        



        



        



        



                                    responsive: true,



        



        



        



        



        



        



        



                                    maintainAspectRatio: false,



        



        



        



        



        



        



        



                                    plugins: {



        



        



        



        



        



        



        



                                        legend: {



        



        



        



        



        



        



        



                                            display: false



        



        



        



        



        



        



        



                                        },



        



        



        



        



        



        



        



                                        title: {



        



        



        



        



        



        



        



                                            display: true,



        



        



        



        



        



        



        



                                            text: 'Total Anggaran per Bagian'



        



        



        



        



        



        



        



                                        },



        



        



        



        



        



        



        



                                        tooltip: {



        



        



        



        



        



        



        



                                            callbacks: {



        



        



        



        



        



        



        



                                                title: function(tooltipItems) {



        



        



        



        



        



        



        



                                                    return fullLabels[tooltipItems[0].dataIndex];



        



        



        



        



        



        



        



                                                },



        



        



        



        



        



        



        



                                                label: function(context) {



        



        



        



        



        



        



        



                                                    let label = context.dataset.label || '';



        



        



        



        



        



        



        



                                                    if (label) {



        



        



        



        



        



        



        



                                                        label += ': ';



        



        



        



        



        



        



        



                                                    }



        



        



        



        



        



        



        



                                                    if (context.parsed.x !== null) {



        



        



        



        



        



        



        



                                                        label += new Intl.NumberFormat('id-ID', {



                                                            style: 'currency',



                                                            currency: 'IDR'



                                                        }).format(context.parsed.x);



        



        



        



        



        



        



        



                                                    }



        



        



        



        



        



        



        



                                                    return label;



        



        



        



        



        



        



        



                                                }



        



        



        



        



        



        



        



                                            }



        



        



        



        



        



        



        



                                        }



        



        



        



        



        



        



        



                                    },



        



        



        



        



        



        



        



                                    scales: {



        



        



        



        



        



        



        



                                        y: {



        



        



        



        



        



        



        



                                            beginAtZero: true,



        



        



        



        



        



        



        



                                            display: true



        



        



        



        



        



        



        



                                        },



        



        



        



        



        



        



        



                                        x: {



        



        



        



        



        



        



        



                                            beginAtZero: true,



        



        



        



        



        



        



        



                                            display: true,



        



        



        



        



        



        



        



                                            ticks: {



        



        



        



        



        



        



        



                                                callback: function(value, index, values) {



        



        



        



        



        



        



        



                                                    if (value >= 1000000000) {



        



        



        



        



        



        



        



                                                        return 'Rp ' + (value / 1000000000) + 'M';



        



        



        



        



        



        



        



                                                    } else if (value >= 1000000) {



        



        



        



        



        



        



        



                                                        return 'Rp ' + (value / 1000000) + 'JT';



        



        



        



        



        



        



        



                                                    }



        



        



        



        



        



        



        



                                                    return 'Rp ' + value;



        



        



        



        



        



        



        



                                                }



        



        



        



        



        



        



        



                                            }



        



        



        



        



        



        



        



                                        }



        



        



        



        



        



        



        



                                    }



        



        



        



        



        



        



        



                                }



        



        



        



        



        



        



        



                            });



        



        



        



        



        



        



        



                        }



        



        



        



        



        



        



        



        



        



        



        



        



        



        



        



                        if (Object.keys(allYearAnggaranBagian).length > 0) {



        



        



        



        



        



        



        



                            anggaranBagianChart = createAnggaranBagianChart(allYearAnggaranBagian);



        



        



        



        



        



        



        



                        }



        



        



        



        



        



        



        



        



        



        



        



        



        



        



        



                        document.getElementById('anggaranBagianYearFilter').addEventListener('change', function() {



        



        



        



        



        



        



        



                            const selectedYear = this.value;



        



        



        



        



        



        



        



                            if (selectedYear === 'all') {



        



        



        



        



        



        



        



                                updateAnggaranBagianChart(anggaranBagianChart, allYearAnggaranBagian);



        



        



        



        



        



        



        



                            } else if (anggaranBagianByYear[selectedYear]) {



        



        



        



        



        



        



        



                                updateAnggaranBagianChart(anggaranBagianChart, anggaranBagianByYear[selectedYear]);



        



        



        



        



        



        



        



                            } else {



        



        



        



        



        



        



        



                                updateAnggaranBagianChart(anggaranBagianChart, {});



        



        



        



        



        



        



        



                            }



        



        



        



        



        



        



        



                        });



        



        



        



        



        



        



        



        



        



        



        



                    });



                </script>



        



            {{-- SweetAlert2 --}}



            <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.js"></script>



            <script src="{{ asset('js/sweetalert2-config.js') }}"></script>



        



            {{-- Session-based Alerts --}}



            @if (session('success'))



                <script>



                    showSuccess('{{ session('success') }}');



                </script>



            @endif



        



            @if (session('error'))



                <script>



                    showError('{{ session('error') }}');



                </script>



            @endif



        



            @if (session('info'))



                <script>



                    showInfo('{{ session('info') }}');



                </script>



            @endif



        



            @if (session('warning'))



                <script>



                    showWarning('{{ session('warning') }}');



                </script>



            @endif



        



        </body>



</html>
